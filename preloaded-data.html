<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="Motaz Mohammad">
<title>Leveraging Redis for Preloading Data: Replacing ODS with In-Memory Performance</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
.tabs {
    margin-bottom: 1.25em;
}

.tablist > ul {
    display: flex;
    flex-wrap: wrap;
    list-style: none;
    margin: 0;
    padding: 0;
}

.tablist > ul li {
    align-items: center;
    background-color: #fff;
    cursor: pointer;
    display: flex;
    font-weight: bold;
    line-height: 1.5;
    padding: 0.25em 1em;
    position: relative;
}

.tablist > ul li:focus-visible {
    outline: none;
}

.tablist.ulist,
.tablist.ulist > ul li {
    margin: 0;
}

.tablist.ulist > ul li + li {
    margin-left: 0.25em;
}

.tabs .tablist li::after {
    content: "";
    display: block;
    height: 1px;
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
}

.tabs.is-loading .tablist li:not(:first-child),
.tabs:not(.is-loading) .tablist li:not(.is-selected) {
    background-color: #f5f5f5;
}

.tabs.is-loading .tablist li:first-child::after,
.tabs:not(.is-loading) .tablist li.is-selected::after {
    background-color: #fff;
}

/*
.tabs:not(.is-loading) .tablist li,
.tabs:not(.is-loading) .tablist li::after {
  transition: background-color 200ms ease-in-out;
}
*/

.tablist > ul p {
    line-height: inherit;
    margin: 0;
}

.tabpanel {
    background-color: #fff;
    padding: 1.25em;
}

.tablist > ul li,
.tabpanel {
    border: 1px solid #dcdcdc;
}

.tablist > ul li {
    border-bottom: 0;
}

.tabs.is-loading .tabpanel + .tabpanel,
.tabs:not(.is-loading) .tabpanel.is-hidden {
    display: none;
}

.tabpanel > :first-child {
    margin-top: 0;
}

/* #content is a signature of the Asciidoctor standalone HTML output */
#content .tabpanel > :last-child,
#content .tabpanel > :last-child > :last-child,
#content .tabpanel > :last-child > :last-child > li:last-child > :last-child {
    margin-bottom: 0;
}

.tablecontainer {
    overflow-x: auto;
}

#content .tablecontainer {
    margin-bottom: 1.25em;
}

#content .tablecontainer > table.tableblock {
    margin-bottom: 0;
}
</style>
</head>
<body class="article">
<div id="header">
<h1>Leveraging Redis for Preloading Data: Replacing ODS with In-Memory Performance</h1>
<div class="details">
<span id="author" class="author">Motaz Mohammad</span><br>
<span id="email" class="email"><a href="mailto:motazco135@gmail.com">motazco135@gmail.com</a></span><br>
<span id="revnumber">version 3.0,</span>
<span id="revdate">November 2, 2024</span>
<br><span id="revremark">AsciiDoc article template</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_why_redis">Why Redis?</a></li>
<li><a href="#_dose_it_replace_operational_data_store">Dose It Replace Operational Data Store ?</a></li>
<li><a href="#_implementation_overview">Implementation Overview</a>
<ul class="sectlevel2">
<li><a href="#_step_1_install_and_configure_redis">Step 1: Install and configure Redis</a></li>
<li><a href="#_step_2_set_up_kafka_jdbc_source_connector_to_push_data_into_kafka">Step 2: Set Up Kafka JDBC Source Connector to Push Data into Kafka</a></li>
<li><a href="#_step_3_set_up_kafka_redis_sink_connector_to_stream_data_from_kafka_to_redis">Step 3: Set Up Kafka Redis Sink Connector to Stream data from Kafka to Redis</a></li>
<li><a href="#_step_4_developing_sample_microservice_to_aggregate_data_in_response">Step 4: Developing Sample Microservice to aggregate data in response</a></li>
</ul>
</li>
<li><a href="#_summary">Summary</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In our previous article on <a href="https://www.linkedin.com/pulse/change-data-capture-debezium-motaz-mohammed-sameh-gqmif%3FtrackingId=lhHqu3HlQbaJNayC%252FRH7Gg%253D%253D/?trackingId=lhHqu3HlQbaJNayC%2FRH7Gg%3D%3D">Change Data Capture (CDC) with Debezium</a>, we demonstrated how to set up CDC using Debezium and Kafka. We used a log-based Kafka connector to replicate data from the database into Kafka topics.</p>
</div>
<div class="paragraph">
<p>Subsequently, we explored building an <a href="https://www.linkedin.com/pulse/operational-data-storeods-motaz-mohammed-sameh-csfrf/?trackingId=7im4G5EjQrCw6c8E3vlrpQ%3D%3D">Operational Data Store (ODS)</a> by leveraging Apache Flink to stream data from Kafka and write it to an ODS database, providing a centralized, real-time data store for various applications to consume fresh data.</p>
</div>
<div class="paragraph">
<p>This article explores how <strong>Redis</strong> can be used to preload essential data, offering an in-memory, high-performance alternative to ODS for certain use cases.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Preloading data refers to the process of loading essential, frequently accessed data into a fast, in-memory store like(Apache Ignite or Rides) before the user requests it. This ensures that when the user logs in, the application can quickly fetch and serve this data without hitting slower, external database or APIs.</p>
</div>
<div class="paragraph">
<p>By using PreLoading data we benefit of the following :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Improved User Experience</strong>: Immediate data availability reduces loading times, enhancing responsiveness.</p>
</li>
<li>
<p><strong>Reduced Load on Backend Systems:</strong> By retrieving preloaded data from Redis, fewer real-time calls are made to the core system.</p>
</li>
<li>
<p><strong>Real-Time Updates:</strong> Using CDC, the data remains fresh and up-to-date.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_redis">Why Redis?</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Fast Data Access</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Redis is an in-memory data store, making it significantly faster for read and write operations compared to traditional databases. This speed is essential for real-time applications where fast access to frequently used data (e.g., customer profile, account balances, transaction history) improves user experience.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Reduce Main Load onm the Main Database and source systems</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>By using Redis as a caching layer or primary store for frequently accessed data, we reduce the load on the main database and source systems. This setup ensures the database doesn’t become a bottleneck when numerous users or applications access it simultaneously, especially during peak times.</p>
</li>
<li>
<p>Redis stores copies of data from the database, allowing the main database to handle fewer queries and reducing the need for frequent, potentially costly queries to the backend.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Compatability with Kafka for real time data sync</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Redis can work well with Kafka connectors to keep cached data in sync with source databases. In this POC, we will see the Redis Sink Connector set up to pull data from Kafka topics and populate Redis in real-time.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Persistence Option for Cashed Data</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Redis can persist data to disk, which makes it ideal not only as a caching layer but also as a durable data store. In this POC, we can configure Redis persistence options to back up in-memory data on disk periodically. This feature helps maintain data availability even if Redis restarts, which is critical for maintaining a consistent state without rebuilding the cache entirely.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dose_it_replace_operational_data_store">Dose It Replace Operational Data Store ?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Redis can effectively replace the ODS (Operational Data Store) layer for specific use cases, particularly for real-time, frequently accessed data.</p>
</div>
<div class="paragraph">
<p>Here’s why Redis serves as a suitable ODS replacement:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>High Performance and Low Latency</p>
</li>
<li>
<p>Real-Time Data Synchronization with Kafka</p>
</li>
<li>
<p>Data Durability with Persistence Options</p>
</li>
<li>
<p>Aggregation and Simplification of Data Access</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, instead of loading all customer and transaction data into an ODS, we can preload recent customer transactions and balance data into Redis.
For detailed historical transactions or analytical queries, we can still rely on ODS.</p>
</div>
<div class="paragraph">
<p>ODS is still beneficial for complex queries, historical data, and larger datasets that don’t fit well in memory.</p>
</div>
<div class="paragraph">
<p>Preloading can be a faster alternative for time-sensitive and high-frequency data but is not a complete replacement for ODS in all use cases.</p>
</div>
<div class="paragraph">
<p>Hybrid ODS approach is my recommendation where Redis can still serve as a fast access layer for the most frequently accessed data, while less commonly accessed data remains in a secondary ODS or database, reducing Redis’s memory load.The critical part is defining which data to store in Redis versus the ODS</p>
</div>
<div class="paragraph">
<p>In summary:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Preloading using Redis solves performance issues for real-time data access.</p>
</li>
<li>
<p>ODS is better for handling larger, less time-sensitive datasets and complex analytics.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_overview">Implementation Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this approach, we utilize preloading concepts with <strong>Redis</strong>, which serves as both an in-memory store for fast access and a persistent storage solution.</p>
</div>
<div class="paragraph">
<p>By leveraging Redis integration with Kafka, we stream real-time data changes captured by JDBC source connector directly into Redis. This effectively replaces the need for an ODS layer, allowing us to store frequently accessed data in memory for performance while ensuring data durability and long-term storage with Redis persistence features.</p>
</div>
<div class="paragraph">
<p>Our Architecture Approach :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/redis/RedisArch.png" alt="RedisArch">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Use Case :</p>
<div class="paragraph">
<p>We have customer profile and customer account information along with available balance at each account and customer account transaction history.</p>
</div>
<div class="paragraph">
<p>All this information are available at source systems however each one is available in a separated API, so to get all of this information we need to call 3 APIs.</p>
</div>
<div class="paragraph">
<p>We will implement preloading concept to make data available at redis which will provide easy and fast access, also we will build a small microservice that  will aggregate all data in one single response.</p>
</div>
</li>
<li>
<p>Implementation Steps :</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Step 1: Install and configure Redis</p>
</li>
<li>
<p>Step 2: Set Up Kafka JDBC Source Connector to Push Data into Kafka</p>
</li>
<li>
<p>Step 3: Set Up Kafka Redis Sink Connector to Stream data from Kafka to Redis</p>
</li>
<li>
<p>Step 4: Developing Sample Microservice to aggregate data in response.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_step_1_install_and_configure_redis">Step 1: Install and configure Redis</h3>
<div class="ulist">
<ul>
<li>
<p>To install Redis we will update our docker compose file to include <a href="https://redis.io/docs/latest/operate/oss_and_stack/install/install-stack/docker/">Redis-Stack</a> as following :</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kafka-postgres-redis</span></span>
<span style="color:#606">version</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'3'</span></span>
<span style="color:#606">services</span>:
  <span style="color:#606">broker</span>:
    <span style="color:#606">image</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">confluentinc/cp-kafka:7.4.0</span></span>
    <span style="color:#606">hostname</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">broker</span></span>
    <span style="color:#606">container_name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">broker</span></span>
    <span style="color:#606">ports</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">9092:9092</span><span style="color:#710">&quot;</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">9101:9101</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">environment</span>:
      <span style="color:#606">KAFKA_NODE_ID</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1</span></span>
      <span style="color:#606">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT'</span></span>
      <span style="color:#606">KAFKA_ADVERTISED_LISTENERS</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'PLAINTEXT://broker:29092,PLAINTEXT_HOST://localhost:9092'</span></span>
      <span style="color:#606">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1</span></span>
      <span style="color:#606">KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">0</span></span>
      <span style="color:#606">KAFKA_TRANSACTION_STATE_LOG_MIN_ISR</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1</span></span>
      <span style="color:#606">KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1</span></span>
      <span style="color:#606">KAFKA_JMX_PORT</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">9101</span></span>
      <span style="color:#606">KAFKA_JMX_HOSTNAME</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">localhost</span></span>
      <span style="color:#606">KAFKA_PROCESS_ROLES</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'broker,controller'</span></span>
      <span style="color:#606">KAFKA_CONTROLLER_QUORUM_VOTERS</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'1@broker:29093'</span></span>
      <span style="color:#606">KAFKA_LISTENERS</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'PLAINTEXT://broker:29092,CONTROLLER://broker:29093,PLAINTEXT_HOST://0.0.0.0:9092'</span></span>
      <span style="color:#606">KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'PLAINTEXT'</span></span>
      <span style="color:#606">KAFKA_CONTROLLER_LISTENER_NAMES</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'CONTROLLER'</span></span>
      <span style="color:#606">KAFKA_LOG_DIRS</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'/tmp/kraft-combined-logs'</span></span>
      <span style="color:#777"># Replace CLUSTER_ID with a unique base64 UUID using &quot;bin/kafka-storage.sh random-uuid&quot;</span>
      <span style="color:#777"># See https://docs.confluent.io/kafka/operations-tools/kafka-tools.html#kafka-storage-sh</span>
      <span style="color:#606">CLUSTER_ID</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'MkU3OEVBNTcwNTJENDM2Qk'</span></span>

  <span style="color:#606">schema-registry</span>:
    <span style="color:#606">image</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">confluentinc/cp-schema-registry:7.4.0</span></span>
    <span style="color:#606">hostname</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">schema-registry</span></span>
    <span style="color:#606">container_name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">schema-registry</span></span>
    <span style="color:#606">depends_on</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">broker</span></span>
    <span style="color:#606">ports</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">8081:8081</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">environment</span>:
      <span style="color:#606">SCHEMA_REGISTRY_HOST_NAME</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">schema-registry</span></span>
      <span style="color:#606">SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'broker:29092'</span></span>
      <span style="color:#606">SCHEMA_REGISTRY_LISTENERS</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">http://0.0.0.0:8081</span></span>

  <span style="color:#606">kafka-connect</span>:
    <span style="color:#606">image</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">confluentinc/cp-kafka-connect-base:latest</span></span>
    <span style="color:#606">container_name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kafka-connect</span></span>
    <span style="color:#606">depends_on</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">broker</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">schema-registry</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">db</span></span>
    <span style="color:#606">ports</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">8083:8083</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">links</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">db:database</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">environment</span>:
      <span style="color:#606">CONNECT_BOOTSTRAP_SERVERS</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">broker:29092</span><span style="color:#710">&quot;</span></span>
      <span style="color:#606">CONNECT_REST_PORT</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">8083</span></span>
      <span style="color:#606">CONNECT_GROUP_ID</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kafka-connect</span></span>
      <span style="color:#606">CONNECT_CONFIG_STORAGE_TOPIC</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">_connect-configs</span></span>
      <span style="color:#606">CONNECT_OFFSET_STORAGE_TOPIC</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">_connect-offsets</span></span>
      <span style="color:#606">CONNECT_STATUS_STORAGE_TOPIC</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">_connect-status</span></span>
      <span style="color:#606">CONNECT_KEY_CONVERTER</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">org.apache.kafka.connect.storage.StringConverter</span></span>
      <span style="color:#606">CONNECT_VALUE_CONVERTER</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">io.confluent.connect.avro.AvroConverter</span></span>
      <span style="color:#606">CONNECT_VALUE_CONVERTER_SCHEMA_REGISTRY_URL</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'http://schema-registry:8081'</span></span>
      <span style="color:#606">CONNECT_REST_ADVERTISED_HOST_NAME</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">kafka-connect</span><span style="color:#710">&quot;</span></span>
      <span style="color:#606">CONNECT_LOG4J_APPENDER_STDOUT_LAYOUT_CONVERSIONPATTERN</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">[%d] %p %X{connector.context}%m (%c:%L)%n</span><span style="color:#710">&quot;</span></span>
      <span style="color:#606">CONNECT_CONFIG_STORAGE_REPLICATION_FACTOR</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span>
      <span style="color:#606">CONNECT_OFFSET_STORAGE_REPLICATION_FACTOR</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span>
      <span style="color:#606">CONNECT_STATUS_STORAGE_REPLICATION_FACTOR</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span>
    <span style="color:#777">#  ---------------</span>
      <span style="color:#606">CONNECT_PLUGIN_PATH</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">/usr/share/java,/usr/share/confluent-hub-components,/data/connect-jars</span></span>
    <span style="color:#777"># If you want to use the Confluent Hub installer to d/l component, but make them available</span>
    <span style="color:#777"># when running this offline, spin up the stack once and then run :</span>
    <span style="color:#777">#   docker cp kafka-connect:/usr/share/confluent-hub-components ./data/connect-jars</span>
    <span style="color:#606">volumes</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">$PWD/data:/data</span></span>
    <span style="color:#777"># In the command section, $ are replaced with $$ to avoid the error 'Invalid interpolation format for &quot;command&quot; option'</span>
    <span style="color:#606">command</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">bash</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">-c</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">|</span></span>
        <span style="color:#F00;background-color:#FAA">echo &quot;Installing Connector&quot;</span>
        <span style="color:#F00;background-color:#FAA">confluent-hub install --no-prompt confluentinc/kafka-connect-jdbc:latest</span>
        <span style="color:#F00;background-color:#FAA">confluent-hub install --no-prompt debezium/debezium-connector-postgresql:latest</span>
        <span style="color:#F00;background-color:#FAA">confluent-hub install --no-prompt apacheignite/kafka-ignite-sink:latest</span>
        <span style="color:#F00;background-color:#FAA">confluent-hub install --no-prompt jcustenborder/kafka-connect-redis:latest</span>
        <span style="color:#777">#</span>
        <span style="color:#F00;background-color:#FAA">echo &quot;Launching Kafka Connect worker&quot;</span>
        <span style="color:#F00;background-color:#FAA">/etc/confluent/docker/run &amp;</span>
        <span style="color:#777">#</span>
        <span style="color:#F00;background-color:#FAA">sleep infinity</span>

  <span style="color:#606">control-center</span>:
    <span style="color:#606">image</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">confluentinc/cp-enterprise-control-center:7.4.0</span></span>
    <span style="color:#606">hostname</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">control-center</span></span>
    <span style="color:#606">container_name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">control-center</span></span>
    <span style="color:#606">depends_on</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">broker</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">schema-registry</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kafka-connect</span></span>
    <span style="color:#606">ports</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">9021:9021</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">environment</span>:
      <span style="color:#606">CONTROL_CENTER_CONNECT_HEALTHCHECK_ENDPOINT</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'/connectors'</span></span>
      <span style="color:#606">CONTROL_CENTER_BOOTSTRAP_SERVERS</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'broker:29092'</span></span>
      <span style="color:#606">CONTROL_CENTER_CONNECT_CONNECT_CLUSTER</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'kafka-connect:8083'</span></span>
      <span style="color:#606">CONTROL_CENTER_SCHEMA_REGISTRY_URL</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://schema-registry:8081</span><span style="color:#710">&quot;</span></span>
      <span style="color:#606">CONTROL_CENTER_REPLICATION_FACTOR</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1</span></span>
      <span style="color:#606">CONTROL_CENTER_INTERNAL_TOPICS_PARTITIONS</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1</span></span>
      <span style="color:#606">CONTROL_CENTER_MONITORING_INTERCEPTOR_TOPIC_PARTITIONS</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1</span></span>
      <span style="color:#606">CONFLUENT_METRICS_TOPIC_REPLICATION</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1</span></span>
      <span style="color:#606">PORT</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">9021</span></span>
    <span style="color:#606">command</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">bash</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">-c</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">|</span></span>
        <span style="color:#F00;background-color:#FAA">echo &quot;Waiting two minutes for Kafka brokers to start and</span>
               <span style="color:#F00;background-color:#FAA">necessary topics to be available&quot;</span>
        <span style="color:#F00;background-color:#FAA">sleep 120</span>
        <span style="color:#F00;background-color:#FAA">/etc/confluent/docker/run</span>

  <span style="color:#606">rest-proxy</span>:
    <span style="color:#606">image</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">confluentinc/cp-kafka-rest:7.4.0</span></span>
    <span style="color:#606">depends_on</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">broker</span></span>
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">schema-registry</span></span>
    <span style="color:#606">ports</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">8082:8082</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">hostname</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">rest-proxy</span></span>
    <span style="color:#606">container_name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">rest-proxy</span></span>
    <span style="color:#606">environment</span>:
      <span style="color:#606">KAFKA_REST_HOST_NAME</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">rest-proxy</span></span>
      <span style="color:#606">KAFKA_REST_BOOTSTRAP_SERVERS</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'broker:29092'</span></span>
      <span style="color:#606">KAFKA_REST_LISTENERS</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://0.0.0.0:8082</span><span style="color:#710">&quot;</span></span>
      <span style="color:#606">KAFKA_REST_SCHEMA_REGISTRY_URL</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">'http://schema-registry:8081'</span></span>

  <span style="color:#606">db</span>:
    <span style="color:#606">image</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">postgres</span></span>
    <span style="color:#606">container_name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">postgres-db</span></span>
    <span style="color:#606">hostname</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">db</span></span>
    <span style="color:#606">ports</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">5432:5432</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">environment</span>:
      <span style="color:#606">POSTGRES_PASSWORD</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">postgres</span></span>

  <span style="color:#606">redis</span>:
    <span style="color:#606">image</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">redis/redis-stack-server:latest</span></span>
    <span style="color:#606">container_name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">redis</span></span>
    <span style="color:#606">hostname</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">redis</span></span>
    <span style="color:#606">ports</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">6379:6379</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">command</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">[</span><span style="color:#D20">
      &quot;redis-server&quot;,
      &quot;--requirepass admin&quot;,
      &quot;--appendonly&quot;, &quot;yes&quot;,       # Enable AOF persistence
      &quot;--save&quot;, &quot;60&quot;, &quot;10000&quot;,     # Save every 1 min if 10,000 keys changed
      &quot;--save&quot;, &quot;300&quot;, &quot;10&quot;,       # Save every 5 mins if 10 keys changed
      &quot;--save&quot;, &quot;900&quot;, &quot;1&quot;,         # Save every 15 mins if 1 key changed
      &quot;--loadmodule&quot;,  &quot;/opt/redis-stack/lib/redisearch.so&quot; , #load redisearch
      &quot;--loadmodule&quot;,&quot;/opt/redis-stack/lib/rejson.so&quot;         #load json.set</span></span>
    ]

  <span style="color:#606">redisinsight</span>:
    <span style="color:#606">image</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">redis/redisinsight:latest</span></span>
    <span style="color:#606">depends_on</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">redis</span></span>
    <span style="color:#606">container_name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">redisinsight</span></span>
    <span style="color:#606">hostname</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">redisinsight</span></span>
    <span style="color:#606">ports</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">5540:5540</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We add Redis in the compose file, also we add the following configuration :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Append-Only file (AOF):</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>--appendonly yes</strong>:</p>
<div class="paragraph">
<p>This enables the AOF (Append-Only File) persistence mechanism. With AOF, Redis logs every write operation (like SET, INCR) to a file. This approach ensures that each data update is recorded, allowing for high durability in case of failure.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>RDB Snapshots:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>--save 60 1000 :</p>
<div class="paragraph">
<p>This configuration specifies that Redis should take a snapshot (RDB file) every 60 seconds if 10,000 keys have changed since the last snapshot. RDB (Redis Database) snapshots capture the entire dataset and save it to disk periodically.</p>
</div>
</li>
<li>
<p>--save 300 10: This configuration creates a snapshot every 5 minutes if at least 10 keys have changed.</p>
</li>
<li>
<p>--save 900 1: This configuration saves the dataset every 15 minutes if at least 1 key has changed.</p>
<div class="paragraph">
<p>RDB is faster for restart recovery but can miss some very recent changes compared to AOF because it only saves at configured intervals. Redis will choose the most recent snapshot file and then, if AOF is enabled, apply any remaining AOF commands to ensure data accuracy.RDB is faster for restart recovery but can miss some very recent changes compared to AOF because it only saves at configured intervals. Redis will choose the most recent snapshot file and then, if AOF is enabled, apply any remaining AOF commands to ensure data accuracy.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_set_up_kafka_jdbc_source_connector_to_push_data_into_kafka">Step 2: Set Up Kafka JDBC Source Connector to Push Data into Kafka</h3>
<div class="paragraph">
<p>Now we have our database , kafka and redis up and running in Docker ,
we will start the  next step where we need to pull new added records or updated data in realtime to Kafka , we will achieve this by using KAFKA JDBC source connector, however before we jump into kafka let&#8217;s first create Database tables</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Database Tables Script:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span style="color:#B06;font-weight:bold">create</span> <span style="color:#339;font-weight:bold">table</span> t_customers
(
    id         serial
        <span style="color:#339;font-weight:bold">constraint</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">T_Customers_pk</span><span style="color:#710">&quot;</span></span>
            <span style="color:#088;font-weight:bold">primary</span> <span style="color:#339;font-weight:bold">key</span>,
    first_name <span style="color:#0a8;font-weight:bold">varchar</span>                             <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>,
    last_name  <span style="color:#0a8;font-weight:bold">varchar</span>                             <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>,
    email      <span style="color:#0a8;font-weight:bold">varchar</span>                             <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>,
    mobile     <span style="color:#0a8;font-weight:bold">varchar</span>                             <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>,
    created_at <span style="color:#0a8;font-weight:bold">timestamp</span> <span style="color:#088;font-weight:bold">default</span> CURRENT_TIMESTAMP <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>,
    updated_at <span style="color:#0a8;font-weight:bold">timestamp</span> <span style="color:#088;font-weight:bold">default</span> CURRENT_TIMESTAMP <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>
);
<span style="color:#B06;font-weight:bold">create</span> <span style="color:#339;font-weight:bold">table</span> t_accounts
(
    id              serial
        <span style="color:#339;font-weight:bold">constraint</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">T_Accounts_pk</span><span style="color:#710">&quot;</span></span>
            <span style="color:#088;font-weight:bold">primary</span> <span style="color:#339;font-weight:bold">key</span>,
    account_number  <span style="color:#0a8;font-weight:bold">integer</span>                             <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>,
    account_status  <span style="color:#0a8;font-weight:bold">varchar</span>                             <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>,
    account_balance <span style="color:#0a8;font-weight:bold">integer</span>                             <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>,
    customer_id     <span style="color:#0a8;font-weight:bold">integer</span>                             <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>
        <span style="color:#339;font-weight:bold">constraint</span> t_accounts_t_customers_id_fk
            <span style="color:#080;font-weight:bold">references</span> t_customers,
    created_at      <span style="color:#0a8;font-weight:bold">timestamp</span> <span style="color:#088;font-weight:bold">default</span> CURRENT_TIMESTAMP <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>,
    updated_at      <span style="color:#0a8;font-weight:bold">timestamp</span> <span style="color:#088;font-weight:bold">default</span> CURRENT_TIMESTAMP <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>
);



<span style="color:#B06;font-weight:bold">create</span> <span style="color:#339;font-weight:bold">table</span> t_transactions
(
    id                     serial
        <span style="color:#339;font-weight:bold">constraint</span> t_transactions_pk
            <span style="color:#088;font-weight:bold">primary</span> <span style="color:#339;font-weight:bold">key</span>,
    transaction_ref_number <span style="color:#0a8;font-weight:bold">varchar</span>                             <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>,
    customer_id            <span style="color:#0a8;font-weight:bold">integer</span>                             <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>
        <span style="color:#339;font-weight:bold">constraint</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">T_Transactions_T_Customers_id_fk</span><span style="color:#710">&quot;</span></span>
            <span style="color:#080;font-weight:bold">references</span> t_customers,
    account_id             <span style="color:#0a8;font-weight:bold">integer</span>                             <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>
        <span style="color:#339;font-weight:bold">constraint</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">T_Transactions_T_Accounts_id_fk</span><span style="color:#710">&quot;</span></span>
            <span style="color:#080;font-weight:bold">references</span> t_accounts,
    transaction_amount     <span style="color:#0a8;font-weight:bold">integer</span>                             <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>,
    transaction_type       <span style="color:#0a8;font-weight:bold">varchar</span>                             <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>,
    created_at             <span style="color:#0a8;font-weight:bold">timestamp</span> <span style="color:#088;font-weight:bold">default</span> CURRENT_TIMESTAMP <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>,
    updated_at             <span style="color:#0a8;font-weight:bold">timestamp</span> <span style="color:#088;font-weight:bold">default</span> CURRENT_TIMESTAMP <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">null</span>
);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will use Kafka <a href="https://docs.confluent.io/kafka-connectors/jdbc/current/index.html">JDBC connector</a>, to be able to use the source connector we will need to install the JDBC connector inside the connector container by using the following command :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">confluent-hub install confluentinc/kafka-connect-jdbc:latest --no-prompt</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command downloads and installs the kafka JDBC connector into the Kafka Connect plugins directory.
After installation completed we should restart the container and the connector will appear as following :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/redis/kafka-sink-redis.png" alt="Confluent Kafka Redis Sink connector">
</div>
<div class="title">Figure 1. JDBC Source Connector for Confluent Platform</div>
</div>
<div class="paragraph">
<p>This connector will capture any database changes and publish the changes to kafka topic.
we will create a separate source connector for each table:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Customers Source Connector:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">JdbcSourceConnectorConnector_Customers</span><span style="color:#710">&quot;</span></span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>config</span><span style="color:#404">&quot;</span></span>: {
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.ExtractKeyField.type</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.apache.kafka.connect.transforms.ExtractField$Key</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.ExtractKeyField.field</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.CastIdToString.spec</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id:string</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.CastIdToString.type</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.apache.kafka.connect.transforms.Cast$Value</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">JdbcSourceConnectorConnector_Customers</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connector.class</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">io.confluent.connect.jdbc.JdbcSourceConnector</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">CastIdToString, SetKey, ExtractKeyField</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.SetKey.type</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.apache.kafka.connect.transforms.ValueToKey</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.SetKey.fields</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connection.url</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jdbc:postgresql://db:5432/postgres</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connection.user</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">postgres</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connection.password</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">********</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>table.whitelist</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>mode</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">timestamp+incrementing</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>incrementing.column.name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>timestamp.column.name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">updated_at</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>query</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">SELECT id,first_name,last_name,email,mobile,created_at, updated_at FROM t_customers</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>topic.prefix</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">customer_profile_t_customers</span><span style="color:#710">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We create the connector and make sure that each kafka message will have a key , we will use these key later in Redis Sink Connector to Store JSON document with that key and will be used later in the query at the microservice.</p>
</div>
</li>
<li>
<p>Accounts Source Connector</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">JdbcSourceConnectorConnector_Accounts</span><span style="color:#710">&quot;</span></span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>config</span><span style="color:#404">&quot;</span></span>: {
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.ExtractKey.type</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.apache.kafka.connect.transforms.ExtractField$Key</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.ExtractKey.field</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.setKEy.fields</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.setKEy.type</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.apache.kafka.connect.transforms.ValueToKey</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">JdbcSourceConnectorConnector_Accounts</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connector.class</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">io.confluent.connect.jdbc.JdbcSourceConnector</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">CastIdToString, setKEy, ExtractKey</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.CastIdToString.type</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.apache.kafka.connect.transforms.Cast$Value</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.CastIdToString.spec</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id:string</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connection.url</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jdbc:postgresql://db:5432/postgres</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connection.user</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">postgres</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connection.password</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">********</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>table.whitelist</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>mode</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">timestamp+incrementing</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>incrementing.column.name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>timestamp.column.name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">updated_at</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>query</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">SELECT   id,CAST(customer_id AS VARCHAR) AS customer_id,CAST(account_number AS VARCHAR) AS account_number,account_status, CAST(account_balance AS VARCHAR) AS account_balance, created_at, updated_at FROM  t_accounts</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>topic.prefix</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">customer_profile_t_accounts</span><span style="color:#710">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Transactions Source Connector</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">JdbcSourceConnectorConnector_Transactions</span><span style="color:#710">&quot;</span></span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>config</span><span style="color:#404">&quot;</span></span>: {
    <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">JdbcSourceConnectorConnector_Transactions</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connector.class</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">io.confluent.connect.jdbc.JdbcSourceConnector</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">CastIdToSttring, SetKey, ExtractKey</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.CastIdToSttring.type</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.apache.kafka.connect.transforms.Cast$Value</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.CastIdToSttring.spec</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id:string</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.SetKey.type</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.apache.kafka.connect.transforms.ValueToKey</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.SetKey.fields</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.ExtractKey.type</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.apache.kafka.connect.transforms.ExtractField$Key</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>transforms.ExtractKey.field</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connection.url</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jdbc:postgresql://db:5432/postgres</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connection.user</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">postgres</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connection.password</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">********</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>table.whitelist</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>mode</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">timestamp+incrementing</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>incrementing.column.name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>timestamp.column.name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">updated_at</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>query</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">SELECT    id,     transaction_ref_number,     CAST(customer_id AS VARCHAR) AS customer_id,     CAST(account_id AS VARCHAR) AS account_id,     CAST(transaction_amount AS VARCHAR) AS transaction_amount,     transaction_type,     created_at,     updated_at FROM     t_transactions</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>topic.prefix</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">customer_profile_t_transactions</span><span style="color:#710">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now lets insert records to Our table to and check kafka topic dose it contains the messages or not:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Insert data to tables:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span style="color:#B06;font-weight:bold">INSERT</span> <span style="color:#B06;font-weight:bold">INTO</span> public.T_Customers (id, first_name, last_name, email, mobile, created_at, updated_at)
<span style="color:#080;font-weight:bold">VALUES</span> (<span style="color:#088;font-weight:bold">DEFAULT</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">motaz</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">motaz</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a@test.com</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">0000000000</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="color:#088;font-weight:bold">DEFAULT</span>, <span style="color:#088;font-weight:bold">DEFAULT</span>);

<span style="color:#B06;font-weight:bold">INSERT</span> <span style="color:#B06;font-weight:bold">INTO</span> public.T_Customers (id, first_name, last_name, email, mobile, created_at, updated_at)
<span style="color:#080;font-weight:bold">VALUES</span> (<span style="color:#088;font-weight:bold">DEFAULT</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">motaz</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">motaz</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">motaz@test.com</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">01234566678</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="color:#088;font-weight:bold">DEFAULT</span>, <span style="color:#088;font-weight:bold">DEFAULT</span>);

<span style="color:#B06;font-weight:bold">INSERT</span> <span style="color:#B06;font-weight:bold">INTO</span> public.T_Accounts (id, account_number, account_status, account_balance, customer_id, created_at, updated_at)
<span style="color:#080;font-weight:bold">VALUES</span> (<span style="color:#088;font-weight:bold">DEFAULT</span>, <span style="color:#00D">111</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">active</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="color:#00D">1000</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="color:#00D">1</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="color:#088;font-weight:bold">DEFAULT</span>, <span style="color:#088;font-weight:bold">DEFAULT</span>);

<span style="color:#B06;font-weight:bold">INSERT</span> <span style="color:#B06;font-weight:bold">INTO</span> public.T_Accounts (id, account_number, account_status, account_balance, customer_id, created_at, updated_at)
<span style="color:#080;font-weight:bold">VALUES</span> (<span style="color:#088;font-weight:bold">DEFAULT</span>, <span style="color:#00D">222</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">active</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="color:#00D">1000</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="color:#00D">2</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="color:#088;font-weight:bold">DEFAULT</span>, <span style="color:#088;font-weight:bold">DEFAULT</span>);

<span style="color:#B06;font-weight:bold">INSERT</span> <span style="color:#B06;font-weight:bold">INTO</span> public.T_Transactions (id, transaction_ref_number, customer_id, account_id, transaction_amount,
                                   transaction_type, created_at, updated_at)
<span style="color:#080;font-weight:bold">VALUES</span> (<span style="color:#088;font-weight:bold">DEFAULT</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ref-01</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="color:#00D">1</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="color:#00D">1</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="color:#00D">10</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Credit</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="color:#088;font-weight:bold">DEFAULT</span>,<span style="color:#088;font-weight:bold">Default</span>);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/redis/kafka-msgs.png" alt="Confluent Kafka Topics">
</div>
<div class="title">Figure 2. Messages are available at kafka topics</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_set_up_kafka_redis_sink_connector_to_stream_data_from_kafka_to_redis">Step 3: Set Up Kafka Redis Sink Connector to Stream data from Kafka to Redis</h3>
<div class="paragraph">
<p>Now that data is flowing into kafka, next step is to sink the data between kafka and redis we have the following options :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a kafka consumer to pull data from kafka topics and write it to Redis.</p>
</li>
<li>
<p>Use Kafka Sink connector to sink the data from kafka topics to Redis.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will use <a href="https://www.confluent.io/hub/redis/redis-kafka-connect">Kafka Redis sink connector</a>, to be able to use the sink connector we will need to install Redis sink connector inside the <strong>connector container</strong> by using the following command :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">confluent-hub install redis/redis-kafka-connect:latest --no-prompt</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command downloads and installs the Redis Sink Connector into the Kafka Connect plugins directory.
After installation completed we should restart the container and the connector will appear as following :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/redis/kafka-sink-redis.png" alt="Confluent Kafka Redis Sink connector">
</div>
<div class="title">Figure 3. Redis Sink Connector for Confluent Platform</div>
</div>
<div class="paragraph">
<p>Now we will configure Redis Sink Connector for each kafka topic:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Customers Sink Connector</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">RedisSinkConnectorConnector_customers</span><span style="color:#710">&quot;</span></span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>config</span><span style="color:#404">&quot;</span></span>: {
    <span style="color:#606"><span style="color:#404">&quot;</span><span>value.converter.schema.registry.url</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://schema-registry:8081</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">RedisSinkConnectorConnector_customers</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connector.class</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">com.redis.kafka.connect.RedisSinkConnector</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>key.converter</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.apache.kafka.connect.storage.StringConverter</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>value.converter</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">io.confluent.connect.avro.AvroConverter</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>topics</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">customer_profile_t_customers</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>redis.cluster</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">false</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>redis.host</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">redis</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>redis.password</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">*****</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>redis.command</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">JSONSET</span><span style="color:#710">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As You see we use String key converter and avro value converter to be able to consume data from the required topic and insert a JSON document in redis</p>
</div>
</li>
<li>
<p>Accounts Sink Connector</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">RedisSinkConnectorConnector_transactions</span><span style="color:#710">&quot;</span></span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>config</span><span style="color:#404">&quot;</span></span>: {
    <span style="color:#606"><span style="color:#404">&quot;</span><span>value.converter.schema.registry.url</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://schema-registry:8081</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">RedisSinkConnectorConnector_transactions</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connector.class</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">com.redis.kafka.connect.RedisSinkConnector</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>key.converter</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.apache.kafka.connect.storage.StringConverter</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>value.converter</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">io.confluent.connect.avro.AvroConverter</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>topics</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">customer_profile_t_transactions</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>redis.cluster</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">false</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>redis.host</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">redis</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>redis.password</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">*****</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>redis.command</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">JSONSET</span><span style="color:#710">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Transactions Sink Connector</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">RedisSinkConnectorConnector_transactions</span><span style="color:#710">&quot;</span></span>,
  <span style="color:#606"><span style="color:#404">&quot;</span><span>config</span><span style="color:#404">&quot;</span></span>: {
    <span style="color:#606"><span style="color:#404">&quot;</span><span>name</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">RedisSinkConnectorConnector_transactions</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>connector.class</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">com.redis.kafka.connect.RedisSinkConnector</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>key.converter</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.apache.kafka.connect.storage.StringConverter</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>value.converter</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.apache.kafka.connect.storage.StringConverter</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>topics</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">customer_transactions_t_transactions</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>redis.cluster</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">false</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>redis.host</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">redis</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>redis.command</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">SET</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>redis.key</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20"> </span><span style="color:#710">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we check Redis Database it will contain  :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/redis/Redis-DB.png" alt="Redis Database">
</div>
<div class="title">Figure 4. Redis Database</div>
</div>
<div class="paragraph">
<p>Now we have the following Json Document as following :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Customer Documents :</p>
<div class="ulist">
<ul>
<li>
<p>Key Format : &lt;topic_name:customer_id&gt;</p>
</li>
<li>
<p>Example :  customer_profile_t_customers:1</p>
</li>
</ul>
</div>
</li>
<li>
<p>Account Documents :</p>
<div class="ulist">
<ul>
<li>
<p>Key Format : &lt;topic_name:account_id&gt;</p>
</li>
<li>
<p>Example :  customer_profile_t_accounts:2</p>
</li>
</ul>
</div>
</li>
<li>
<p>Customer Topic Documents :</p>
<div class="ulist">
<ul>
<li>
<p>Key Format : &lt;topic_name:transaction_id&gt;</p>
</li>
<li>
<p>Example :  customer_profile_t_transactions:2</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_developing_sample_microservice_to_aggregate_data_in_response">Step 4: Developing Sample Microservice to aggregate data in response</h3>
<div class="paragraph">
<p>Now we will start Developing our sample microservice , we will use Spring Boot framework and <a href="https://redis.io/learn/develop/java/spring/redis-om/redis-om-spring">Redis OM -Spring</a>, The aim of the Redis OM family of projects is to provide high-level abstractions idiomatically implemented for your language/platform of choice.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We&#8217;ll Start by creating SpringBoot application using the <a href="https://start.spring.io/">Spring initializer</a>, we will use the following maven dependency.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span style="color:#070;font-weight:bold">&lt;dependencies&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>com.redis.om<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>redis-om-spring<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;version&gt;</span>0.9.7<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>

        <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.projectlombok<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>lombok<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;optional&gt;</span>true<span style="color:#070;font-weight:bold">&lt;/optional&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-test<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;scope&gt;</span>test<span style="color:#070;font-weight:bold">&lt;/scope&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.springdoc<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>springdoc-openapi-starter-webmvc-ui<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;version&gt;</span>2.6.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Enabling Redis Document Repositories</p>
<div class="paragraph">
<p>To enable the Redis Document Repositories we add the <mark>@EnableRedisDocumentRepositories</mark> which will allow us to use the RedisDocumentRepository class as the type of our Data Repositories.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/redis/main.png" alt="Main Class">
</div>
<div class="title">Figure 5. Main Class</div>
</div>
</li>
<li>
<p>Domain Entity
We&#8217;ll have Three Classes in out microservice, the Customer class , Account Class and Transaction Class,
To mark the class as JSON document we use the <mark>@Document</mark> annotation</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Data</span>
<span style="color:#007">@RequiredArgsConstructor</span>(staticName = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">of</span><span style="color:#710">&quot;</span></span>)
<span style="color:#007">@AllArgsConstructor</span>(access = AccessLevel.PROTECTED)
<span style="color:#007">@Document</span>(value=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">customer_profile_t_customers</span><span style="color:#710">&quot;</span></span>,indexName = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">CustomerIdx</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Customer</span> {

    <span style="color:#007">@Id</span>
    <span style="color:#007">@Indexed</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> id;

    <span style="color:#007">@Indexed</span>
    <span style="color:#007">@SerializedName</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">first_name</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> firstName;

    <span style="color:#007">@Indexed</span>
    <span style="color:#007">@SerializedName</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">last_name</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> lastName;

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> email;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> mobile;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Redis OM-Spring provide capitulates on tob of the Spring Data Redis plus :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>@Indexed:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Marks a field as indexed, making it possible to search by that field.This is typically used for basic text search fields, but not support partial or wildcard matches</p>
</li>
</ol>
</div>
</li>
<li>
<p>@Searchable:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Specifically designed for full-text search capabilities.Allows for searching text fields with partial matches, wildcard searches.</p>
</li>
</ol>
</div>
</li>
<li>
<p>@TagIndexed:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Used for fields where you need to filter on specific values or categories.Supports exact and wildcard matches.</p>
<div class="paragraph">
<p>We will create the same to the tow remaining  JSON document (Account&amp;Transaction)</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Repository Class</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Repository</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">interface</span> <span style="color:#B06;font-weight:bold">CustomerRepository</span> <span style="color:#088;font-weight:bold">extends</span> RedisDocumentRepository&lt;Customer,<span style="color:#0a8;font-weight:bold">String</span>&gt; {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use Repository class to access the Redis document and be able to run requires.</p>
</div>
</li>
<li>
<p>Controller :</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@RestController</span>
<span style="color:#007">@RequestMapping</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/customer</span><span style="color:#710">&quot;</span></span>)
<span style="color:#007">@RequiredArgsConstructor</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CustomerController</span> {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> CustomerService customerService;

    <span style="color:#007">@GetMapping</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/{customerId}/complete-profile</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">public</span> ResponseEntity&lt;Customer&gt; getCustomerProfile(<span style="color:#007">@PathVariable</span> <span style="color:#0a8;font-weight:bold">String</span> customerId) {
        Optional&lt;Customer&gt; profile = customerService.getCustomerProfile(customerId);
        <span style="color:#080;font-weight:bold">if</span>(profile.isPresent()) {
           <span style="color:#080;font-weight:bold">return</span> ResponseEntity.ok(profile.get());
        }
        <span style="color:#080;font-weight:bold">return</span> ResponseEntity.notFound().build();
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Run Request
Call the customer service by customer id =1</p>
<div class="imageblock">
<div class="content">
<img src="resources/redis/request.png" alt="Get Cutomer Profile">
</div>
<div class="title">Figure 6. Customer Profile</div>
</div>
<div class="paragraph">
<p>Now we can create aggregated Customer profile to get customer and his related accounts and list of top 5 transaction on each account .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span style="color:#088;font-weight:bold">public</span> Optional&lt;CompleteProfileResponse&gt; getCustomerCompleteProfile(<span style="color:#0a8;font-weight:bold">String</span> customerId){
        Optional&lt;Customer&gt; optionalCustomer = customerRepository.findById(customerId);
        <span style="color:#080;font-weight:bold">if</span>(optionalCustomer.isEmpty()){
            <span style="color:#080;font-weight:bold">return</span> Optional.empty();
        }
        <span style="color:#0a8;font-weight:bold">Iterable</span>&lt;Account&gt; accounts = accountRepository.findByCustomerId(customerId);
        <span style="color:#0a8;font-weight:bold">List</span>&lt;AccountResponse&gt; accountResponseList = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">ArrayList</span>&lt;&gt;();
        accounts.forEach(account -&gt; {
            <span style="color:#0a8;font-weight:bold">List</span>&lt;Transaction&gt; recentTransactions = transactionRepository.findTop10ByAccountIdOrderByCreatedAtDesc(account.getId());
            accountResponseList.add(<span style="color:#080;font-weight:bold">new</span> AccountResponse(account,recentTransactions) );
        });

        AccountResponse accountResponse = <span style="color:#080;font-weight:bold">new</span> AccountResponse();
        <span style="color:#080;font-weight:bold">return</span> Optional.of(<span style="color:#080;font-weight:bold">new</span> CompleteProfileResponse(optionalCustomer.get(), accountResponseList));
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span style="color:#606"><span style="color:#404">&quot;</span><span>customer</span><span style="color:#404">&quot;</span></span>: {
    <span style="color:#606"><span style="color:#404">&quot;</span><span>id</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>firstName</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">motaz</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>lastName</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">motaz</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>email</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">a@test.com</span><span style="color:#710">&quot;</span></span>,
    <span style="color:#606"><span style="color:#404">&quot;</span><span>mobile</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">0000000000</span><span style="color:#710">&quot;</span></span>
  },
  <span style="color:#606"><span style="color:#404">&quot;</span><span>accounts</span><span style="color:#404">&quot;</span></span>: [
    {
      <span style="color:#606"><span style="color:#404">&quot;</span><span>account</span><span style="color:#404">&quot;</span></span>: {
        <span style="color:#606"><span style="color:#404">&quot;</span><span>id</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">2</span><span style="color:#710">&quot;</span></span>,
        <span style="color:#606"><span style="color:#404">&quot;</span><span>accountNumber</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">111</span><span style="color:#710">&quot;</span></span>,
        <span style="color:#606"><span style="color:#404">&quot;</span><span>accountStatus</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">active</span><span style="color:#710">&quot;</span></span>,
        <span style="color:#606"><span style="color:#404">&quot;</span><span>accountBalance</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1000</span><span style="color:#710">&quot;</span></span>,
        <span style="color:#606"><span style="color:#404">&quot;</span><span>customerId</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span>
      },
      <span style="color:#606"><span style="color:#404">&quot;</span><span>transactions</span><span style="color:#404">&quot;</span></span>: []
    },
    {
      <span style="color:#606"><span style="color:#404">&quot;</span><span>account</span><span style="color:#404">&quot;</span></span>: {
        <span style="color:#606"><span style="color:#404">&quot;</span><span>id</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">4</span><span style="color:#710">&quot;</span></span>,
        <span style="color:#606"><span style="color:#404">&quot;</span><span>accountNumber</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">333</span><span style="color:#710">&quot;</span></span>,
        <span style="color:#606"><span style="color:#404">&quot;</span><span>accountStatus</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">active</span><span style="color:#710">&quot;</span></span>,
        <span style="color:#606"><span style="color:#404">&quot;</span><span>accountBalance</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">100</span><span style="color:#710">&quot;</span></span>,
        <span style="color:#606"><span style="color:#404">&quot;</span><span>customerId</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span>
      },
      <span style="color:#606"><span style="color:#404">&quot;</span><span>transactions</span><span style="color:#404">&quot;</span></span>: [
        {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>id</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">4</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>transactionRefNumber</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ref-02</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>customerId</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>accountId</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">4</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>transactionAmount</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">10</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>transactionType</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Credit</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>createdAt</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1730509389682</span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>updatedAt</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1730509389682</span>
        },
        {
          <span style="color:#606"><span style="color:#404">&quot;</span><span>id</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">2</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>transactionRefNumber</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ref-02</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>customerId</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>accountId</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">4</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>transactionAmount</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">10</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>transactionType</span><span style="color:#404">&quot;</span></span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Credit</span><span style="color:#710">&quot;</span></span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>createdAt</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1730335188316</span>,
          <span style="color:#606"><span style="color:#404">&quot;</span><span>updatedAt</span><span style="color:#404">&quot;</span></span>: <span style="color:#00D">1730433794472</span>
        }
      ]
    }
  ]
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this article, we explored an optimized approach for preloading data using Redis and Kafka connectors, particularly for real-time applications that need fast, efficient data access. We demonstrated how Redis can serve as an effective alternative to traditional ODS layers, reducing database load and providing enhanced data retrieval speed.</p>
</div>
<div class="paragraph">
<p>We also introduced an aggregation service that consolidates customer data, account summaries, and recent transactions into a single API, enhancing the user experience.</p>
</div>
<div class="paragraph">
<p>Full implementation details are available in the GitHub repository for further customization. <a href="https://github.com/motazco135/data-preload/">GitHub</a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.0<br>
Last updated 2024-11-02 04:41:48 +0300
</div>
</div>
<script>
;(function () { /*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
  'use strict'

  var config = (document.currentScript || {}).dataset || {}
  var forEach = Array.prototype.forEach

  init(document.querySelectorAll('.tabs'))

  function init (tabsBlocks) {
    if (!tabsBlocks.length) return
    forEach.call(tabsBlocks, function (tabs) {
      var syncIds = tabs.classList.contains('is-sync') ? {} : undefined
      var tablist = tabs.querySelector('.tablist ul')
      tablist.setAttribute('role', 'tablist')
      var start
      forEach.call(tablist.querySelectorAll('li'), function (tab, idx) {
        tab.tabIndex = -1
        tab.setAttribute('role', tab.classList.add('tab') || 'tab')
        var id, anchor, syncId
        if (!(id = tab.id) && (anchor = tab.querySelector('a[id]'))) {
          id = tab.id = anchor.parentNode.removeChild(anchor).id
        }
        var panel = id && tabs.querySelector('.tabpanel[aria-labelledby~="' + id + '"]')
        if (!panel) return idx ? undefined : toggleSelected(tab, true) // invalid state
        syncIds && (((syncId = tab.textContent.trim()) in syncIds) ? (syncId = undefined) : true) &&
        (syncIds[(tab.dataset.syncId = syncId)] = tab)
        idx || (syncIds && (start = { tab: tab, panel: panel })) ? toggleHidden(panel, true) : toggleSelected(tab, true)
        tab.setAttribute('aria-controls', panel.id)
        panel.setAttribute('role', 'tabpanel')
        var onClick = syncId === undefined ? activateTab : activateTabSync
        tab.addEventListener('click', onClick.bind({ tabs: tabs, tab: tab, panel: panel }))
      })
      if (!tabs.closest('.tabpanel')) {
        forEach.call(tabs.querySelectorAll('.tabpanel table.tableblock'), function (table) {
          var container = Object.assign(document.createElement('div'), { className: 'tablecontainer' })
          table.parentNode.insertBefore(container, table).appendChild(table)
        })
      }
      if (start) {
        var syncGroupId
        for (var i = 0, lst = tabs.classList, len = lst.length, className; i !== len; i++) {
          if (!(className = lst.item(i)).startsWith('data-sync-group-id=')) continue
          tabs.dataset.syncGroupId = syncGroupId = lst.remove(className) || className.slice(19).replace(/\u00a0/g, ' ')
          break
        }
        if (syncGroupId === undefined) tabs.dataset.syncGroupId = syncGroupId = Object.keys(syncIds).sort().join('|')
        var preferredSyncId = 'syncStorageKey' in config &&
          window[(config.syncStorageScope || 'local') + 'Storage'].getItem(config.syncStorageKey + '-' + syncGroupId)
        var tab = preferredSyncId && syncIds[preferredSyncId]
        tab && Object.assign(start, { tab: tab, panel: document.getElementById(tab.getAttribute('aria-controls')) })
        toggleSelected(start.tab, true) || toggleHidden(start.panel, false)
      }
    })
    onHashChange()
    toggleClassOnEach(tabsBlocks, 'is-loading', 'remove')
    window.setTimeout(toggleClassOnEach.bind(null, tabsBlocks, 'is-loaded', 'add'), 0)
    window.addEventListener('hashchange', onHashChange)
  }

  function activateTab (e) {
    var tab = this.tab
    var tabs = this.tabs || (this.tabs = tab.closest('.tabs'))
    var panel = this.panel || (this.panel = document.getElementById(tab.getAttribute('aria-controls')))
    querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (el) {
      toggleSelected(el, el === tab)
    })
    querySelectorWithSiblings(tabs, '.tabpanel', 'tabpanel').forEach(function (el) {
      toggleHidden(el, el !== panel)
    })
    if (!this.isSync && 'syncStorageKey' in config && 'syncGroupId' in tabs.dataset) {
      var storageKey = config.syncStorageKey + '-' + tabs.dataset.syncGroupId
      window[(config.syncStorageScope || 'local') + 'Storage'].setItem(storageKey, tab.dataset.syncId)
    }
    if (!e) return
    var loc = window.location
    var hashIdx = loc.hash ? loc.href.indexOf('#') : -1
    if (~hashIdx) window.history.replaceState(null, '', loc.href.slice(0, hashIdx))
    e.preventDefault()
  }

  function activateTabSync (e) {
    activateTab.call(this, e)
    var thisTabs = this.tabs
    var thisTab = this.tab
    var initialY = thisTabs.getBoundingClientRect().y
    forEach.call(document.querySelectorAll('.tabs'), function (tabs) {
      if (tabs === thisTabs || tabs.dataset.syncGroupId !== thisTabs.dataset.syncGroupId) return
      querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (tab) {
        if (tab.dataset.syncId === thisTab.dataset.syncId) activateTab.call({ tabs: tabs, tab: tab, isSync: true })
      })
    })
    var shiftedBy = thisTabs.getBoundingClientRect().y - initialY
    if (shiftedBy && (shiftedBy = Math.round(shiftedBy))) window.scrollBy({ top: shiftedBy, behavior: 'instant' })
  }

  function querySelectorWithSiblings (scope, selector, siblingClass) {
    var el = scope.querySelector(selector)
    if (!el) return []
    var result = [el]
    while ((el = el.nextElementSibling) && el.classList.contains(siblingClass)) result.push(el)
    return result
  }

  function toggleClassOnEach (elements, className, method) {
    forEach.call(elements, function (el) {
      el.classList[method](className)
    })
  }

  function toggleHidden (el, state) {
    el.classList[(el.hidden = state) ? 'add' : 'remove']('is-hidden')
  }

  function toggleSelected (el, state) {
    el.setAttribute('aria-selected', '' + state)
    el.classList[state ? 'add' : 'remove']('is-selected')
    el.tabIndex = state ? 0 : -1
  }

  function onHashChange () {
    var id = window.location.hash.slice(1)
    if (!id) return
    var tab = document.getElementById(~id.indexOf('%') ? decodeURIComponent(id) : id)
    if (!(tab && tab.classList.contains('tab'))) return
    'syncId' in tab.dataset ? activateTabSync.call({ tab: tab }) : activateTab.call({ tab: tab })
  }
})()
</script>
</body>
</html>