<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="Motaz Mohammad">
<title>Real Time Data Streaming</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
.tabs {
    margin-bottom: 1.25em;
}

.tablist > ul {
    display: flex;
    flex-wrap: wrap;
    list-style: none;
    margin: 0;
    padding: 0;
}

.tablist > ul li {
    align-items: center;
    background-color: #fff;
    cursor: pointer;
    display: flex;
    font-weight: bold;
    line-height: 1.5;
    padding: 0.25em 1em;
    position: relative;
}

.tablist > ul li:focus-visible {
    outline: none;
}

.tablist.ulist,
.tablist.ulist > ul li {
    margin: 0;
}

.tablist.ulist > ul li + li {
    margin-left: 0.25em;
}

.tabs .tablist li::after {
    content: "";
    display: block;
    height: 1px;
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
}

.tabs.is-loading .tablist li:not(:first-child),
.tabs:not(.is-loading) .tablist li:not(.is-selected) {
    background-color: #f5f5f5;
}

.tabs.is-loading .tablist li:first-child::after,
.tabs:not(.is-loading) .tablist li.is-selected::after {
    background-color: #fff;
}

/*
.tabs:not(.is-loading) .tablist li,
.tabs:not(.is-loading) .tablist li::after {
  transition: background-color 200ms ease-in-out;
}
*/

.tablist > ul p {
    line-height: inherit;
    margin: 0;
}

.tabpanel {
    background-color: #fff;
    padding: 1.25em;
}

.tablist > ul li,
.tabpanel {
    border: 1px solid #dcdcdc;
}

.tablist > ul li {
    border-bottom: 0;
}

.tabs.is-loading .tabpanel + .tabpanel,
.tabs:not(.is-loading) .tabpanel.is-hidden {
    display: none;
}

.tabpanel > :first-child {
    margin-top: 0;
}

/* #content is a signature of the Asciidoctor standalone HTML output */
#content .tabpanel > :last-child,
#content .tabpanel > :last-child > :last-child,
#content .tabpanel > :last-child > :last-child > li:last-child > :last-child {
    margin-bottom: 0;
}

.tablecontainer {
    overflow-x: auto;
}

#content .tablecontainer {
    margin-bottom: 1.25em;
}

#content .tablecontainer > table.tableblock {
    margin-bottom: 0;
}
</style>
</head>
<body class="article">
<div id="header">
<h1>Real Time Data Streaming</h1>
<div class="details">
<span id="author" class="author">Motaz Mohammad</span><br>
<span id="email" class="email"><a href="mailto:motazco135@gmail.com">motazco135@gmail.com</a></span><br>
<span id="revnumber">version 3.0,</span>
<span id="revdate">November 18, 2024</span>
<br><span id="revremark">AsciiDoc article template</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction_to_real_time_data_processing">Introduction to Real-Time Data Processing</a></li>
<li><a href="#_use_case_scenario_average_customer_spending_calculation">Use Case Scenario: Average Customer Spending Calculation</a></li>
<li><a href="#_kafka_stream">Kafka Stream</a></li>
<li><a href="#_use_case_implementation">Use Case Implementation</a>
<ul class="sectlevel2">
<li><a href="#_step_1_create_kafka_steam_app">Step 1: Create Kafka Steam App</a></li>
<li><a href="#_step_2_create_redis_sink_connector">Step 2: Create Redis Sink Connector</a></li>
<li><a href="#_step_3_update_microservice_to_read_data_from_redis">Step 3: Update Microservice to Read data from Redis</a></li>
</ul>
</li>
<li><a href="#_summary">Summary</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In our latest article we explored an optimized approach for <a href="https://www.linkedin.com/pulse/leveraging-redis-preloading-data-replacing-ods-motaz-mohammed-sameh-uhn4f/?trackingId=6i5vMoD2QlOtqYVVtzZZFg%3D%3D">Preloading data using Redis and Kafka Connectors</a>, particular for real time applications that need fast, efficient data access. We demonstrate how redis can serve as an effective alternative to traditional ODS layers, reducing database load and providing enhanced data retrieval speed.</p>
</div>
<div class="paragraph">
<p>In this article will introduce kafka stream for producing and processing real time data .</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_to_real_time_data_processing">Introduction to Real-Time Data Processing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Real-time Streaming refers to quickly processing data, A continuous data stream is processed as received and outcomes are stored for review or record.Rail time processing differs from batch processing , which ingests and retains data to be reviewed at a later time or data.</p>
</div>
<div class="paragraph">
<p>Real time data processing enable data Owners/Business to interpret data on demand and make decisions accordingly.
this approach also eliminates the need to store large data,since the data is processed continuously in a real time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_use_case_scenario_average_customer_spending_calculation">Use Case Scenario: Average Customer Spending Calculation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will continue from our latest use case Scenario where we aggregate our customer profile, accounts and latest transactions, we will add important information to our customer that will enable them to understand spending patterns, By calculating the average customer spending in real time,this will help our customers manage their finances better.</p>
</div>
<div class="paragraph">
<p>In this scenario we will use Kafka steam to continuously process transaction data , calculate the average spending and store the results in Redis for fast retrieval.</p>
</div>
<div class="paragraph">
<p>Our Architecture will leverage Kafka stream to compute average spending per customer by aggregating their transaction data in real time. The processed data will be stored in Redis, where it can be accessed by our microservice that retrieves and display this information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kafka_stream">Kafka Stream</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kafka Streams is a Java library that we use to write stream processing applications. It&#8217;s a standalone app that streams records to and from Kafka.</p>
</div>
<div class="paragraph">
<p>The core of a Kafka stream application is its topology, which defines how data flows through various processing nodes. A topology is a directed graph of stream processors (nodes) and streams (edges).</p>
</div>
<div class="paragraph">
<p>Kafka stream application has a series of processes :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Source processor that read data from source topic or topics</p>
</li>
<li>
<p>Stream processor where we have the processing Logic which is responsible for acting on the data from source processor(kafka topic) this could be aggregation , transforming or joining the data this is where the  data enrichment happens.</p>
</li>
<li>
<p>Sink processor where the processed data returned to output kafka topic.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This collection of processors together forms the Topology.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/kstream/stream-topology.png" alt="Kafka Stream Topology">
</div>
<div class="title">Figure 1. Kafka Stream Topology</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_use_case_implementation">Use Case Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>in order to implement our use case we need to  follow the following steps :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 1: Create Kafka Steam App</p>
</li>
<li>
<p>Step 2: Create Redis Sink Connector</p>
</li>
<li>
<p>Step 3: Update Microservice to Read data from Redis</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_step_1_create_kafka_steam_app">Step 1: Create Kafka Steam App</h3>
<div class="paragraph">
<p>As we discussed kafka stream is a java library which primary focuses on :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Data Enrichment</p>
</li>
<li>
<p>Transformation of data</p>
</li>
<li>
<p>Aggregation of data</p>
</li>
<li>
<p>Joining data from multiple kafka topics</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Kafka Stream API uses Functional Programming Style.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Data Flow in a Kafka Stream App</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Kafka Stream App initiate the stream processing by subscripting to kafka topic.</p>
</li>
<li>
<p>Act on data from kafka topic by applying operation like Aggregation , transforming and joining data etc&#8230;&#8203;</p>
</li>
<li>
<p>Once a processing completes wire the data back to kafka topic.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/kstream/stream-dfd.png" alt="Data Flow in a Kafka Stream">
</div>
<div class="title">Figure 2. Data Flow in a Kafka Stream</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When we create the Kafka JDBC source connector to  read from transaction table the connector created the topic and use avro schema to make publish the data to kafka topic,
as shown below :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/kstream/kafka-schemma.png" alt="Kafka Topic Avro Scheam">
</div>
<div class="title">Figure 3. Kafka Topic Avro Schema</div>
</div>
<div class="paragraph">
<p>Avro is an open source data serialization system that helps with data exchange between systems, programming languages, and processing frameworks. Avro helps define a binary format for your data, as well as map it to the programming language of your choice.</p>
</div>
<div class="paragraph">
<p>For our stream app to start consuming the messages from transaction topic we need to deserialize the messages and map it to POJO this can be easily done by the following steps :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the Avro Schema and add it to the resource folder</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/kstream/resource-aro.png" alt="Avro Schema">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use Maven Aro plugin to read the schema and generate POJO class</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.apache.avro<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>avro-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.12.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
                    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>generate-sources<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
                            <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>schema<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
                            <span style="color:#070;font-weight:bold">&lt;sourceDirectory&gt;</span>${project.basedir}/src/main/resources/avro/<span style="color:#070;font-weight:bold">&lt;/sourceDirectory&gt;</span>
                            <span style="color:#070;font-weight:bold">&lt;outputDirectory&gt;</span>${project.build.directory}/generated-sources<span style="color:#070;font-weight:bold">&lt;/outputDirectory&gt;</span>
                            <span style="color:#070;font-weight:bold">&lt;stringType&gt;</span>String<span style="color:#070;font-weight:bold">&lt;/stringType&gt;</span>
                            <span style="color:#070;font-weight:bold">&lt;fieldVisibility&gt;</span>PRIVATE<span style="color:#070;font-weight:bold">&lt;/fieldVisibility&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
                    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So now our complete maven dependency will be as following :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#579">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span style="color:#070;font-weight:bold">&lt;project</span> <span style="color:#b48">xmlns</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://maven.apache.org/POM/4.0.0</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">xmlns:xsi</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://www.w3.org/2001/XMLSchema-instance</span><span style="color:#710">&quot;</span></span>
         <span style="color:#b48">xsi:schemaLocation</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;modelVersion&gt;</span>4.0.0<span style="color:#070;font-weight:bold">&lt;/modelVersion&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;parent&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-parent<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;version&gt;</span>3.3.5<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;relativePath</span><span style="color:#070;font-weight:bold">/&gt;</span> <span style="color:#777">&lt;!-- lookup parent from repository --&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/parent&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>com.motaz<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>transaction-stream<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;version&gt;</span>0.0.1-SNAPSHOT<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;name&gt;</span>transaction-stream<span style="color:#070;font-weight:bold">&lt;/name&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;description&gt;</span>transaction-stream<span style="color:#070;font-weight:bold">&lt;/description&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;properties&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;java.version&gt;</span>21<span style="color:#070;font-weight:bold">&lt;/java.version&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/properties&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;dependencies&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.apache.kafka<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>kafka-streams<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.springframework.kafka<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>spring-kafka<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>

        <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.projectlombok<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>lombok<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;optional&gt;</span>true<span style="color:#070;font-weight:bold">&lt;/optional&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-test<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;scope&gt;</span>test<span style="color:#070;font-weight:bold">&lt;/scope&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.springframework.kafka<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>spring-kafka-test<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;scope&gt;</span>test<span style="color:#070;font-weight:bold">&lt;/scope&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>jackson-databind<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;version&gt;</span>2.17.2<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>io.confluent<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>kafka-avro-serializer<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;version&gt;</span>7.7.1<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>io.confluent<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>kafka-streams-avro-serde<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;version&gt;</span>7.7.1<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/dependencies&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;repositories&gt;</span>
        <span style="color:#777">&lt;!-- other maven repositories the project --&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;repository&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;id&gt;</span>confluent<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;url&gt;</span>https://packages.confluent.io/maven/<span style="color:#070;font-weight:bold">&lt;/url&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/repository&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/repositories&gt;</span>

    <span style="color:#070;font-weight:bold">&lt;build&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;plugins&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
                    <span style="color:#070;font-weight:bold">&lt;excludes&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;exclude&gt;</span>
                            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.projectlombok<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
                            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>lombok<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;/exclude&gt;</span>
                    <span style="color:#070;font-weight:bold">&lt;/excludes&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.apache.avro<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>avro-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.12.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
                    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>generate-sources<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
                            <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>schema<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
                            <span style="color:#070;font-weight:bold">&lt;sourceDirectory&gt;</span>${project.basedir}/src/main/resources/avro/<span style="color:#070;font-weight:bold">&lt;/sourceDirectory&gt;</span>
                            <span style="color:#070;font-weight:bold">&lt;outputDirectory&gt;</span>${project.build.directory}/generated-sources<span style="color:#070;font-weight:bold">&lt;/outputDirectory&gt;</span>
                            <span style="color:#070;font-weight:bold">&lt;stringType&gt;</span>String<span style="color:#070;font-weight:bold">&lt;/stringType&gt;</span>
                            <span style="color:#070;font-weight:bold">&lt;fieldVisibility&gt;</span>PRIVATE<span style="color:#070;font-weight:bold">&lt;/fieldVisibility&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
                    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/plugins&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/build&gt;</span>

<span style="color:#070;font-weight:bold">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s use application.yml to provide the Kafka configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">spring</span>:
  <span style="color:#606">application</span>:
   <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">transaction-stream</span></span>
  <span style="color:#606">kafka</span>:
    <span style="color:#606">streams</span>:
      <span style="color:#606">bootstrap-servers</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">PLAINTEXT_HOST://localhost:9092</span></span>
      <span style="color:#606">application-id</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">transaction-streams-app</span></span>
    <span style="color:#606">properties</span>:
      <span style="color:#606">schema.registry.url</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://localhost:8081</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In our example, we’ve provided the application id and bootstrap server connection details for our configuration.</p>
</div>
<div class="paragraph">
<p>let’s define the Kafka stream configuration</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@SpringBootApplication</span>
<span style="color:#007">@EnableKafka</span>
<span style="color:#007">@EnableKafkaStreams</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">TransactionStreamApplication</span> {

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        SpringApplication.run(TransactionStreamApplication.class, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we’ve used the @EnableKafkaStreams annotation to autoconfigure the required components.
As a result, Spring Boot uses this configuration and creates a KafkaStreams client to manage our application lifecycle</p>
</div>
<div class="paragraph">
<p>Now that we’ve set up the configuration, let’s build the topology for our application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Slf4j</span>
<span style="color:#007">@Component</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">AverageTransactionTopology</span> {

    <span style="color:#007">@Value</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">${spring.kafka.topics.transaction_topic}</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> TRANSACTION_TOPIC;

    <span style="color:#007">@Value</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">${spring.kafka.topics.average-spending_topic}</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> TRANSACTION_AVERAGE_SPENDING_TOPIC;

    <span style="color:#007">@Value</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">${spring.kafka.properties.schema.registry.url}</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> SCHEMA_REGISTRY_URL;

    <span style="color:#777">// Source stream from the topic</span>
    <span style="color:#007">@Autowired</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> process(StreamsBuilder streamsBuilder){
        <span style="color:#777">//create serde for Serialization and Deserialization</span>
        Serde&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; stringSerde = Serdes.String();
        Serde&lt;AverageSpending&gt; averageSpendingSerde = <span style="color:#080;font-weight:bold">new</span> JsonSerde&lt;&gt;(AverageSpending.class);
        Serde&lt;Transactions&gt; transactionSerde = createTransactionAvroSerde(SCHEMA_REGISTRY_URL);

        KStream&lt;<span style="color:#0a8;font-weight:bold">String</span>,Transactions&gt; transactionStream = streamsBuilder.stream(TRANSACTION_TOPIC,
                Consumed.with(stringSerde,transactionSerde)
        );

        transactionStream
                .print(Printed.&lt;<span style="color:#0a8;font-weight:bold">String</span>,Transactions&gt;toSysOut().withLabel(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">transactions</span><span style="color:#710">&quot;</span></span>));

        <span style="color:#777">// Group by customerId, then aggregate</span>
        KTable&lt;<span style="color:#0a8;font-weight:bold">String</span>, AverageSpending&gt; averageSpendingTable = transactionStream
                .filter((key,transaction)-&gt;isCreditTransaction(transaction))
                .groupBy((key, transaction) -&gt; transaction.getCustomerId(), Grouped.with(stringSerde, transactionSerde))
                .aggregate(
                        AverageSpending::<span style="color:#080;font-weight:bold">new</span>,
                        (customerId, transaction, agg) -&gt; updateAverageSpending(customerId, transaction, agg),
                        Materialized.with(stringSerde, averageSpendingSerde)
                );

        <span style="color:#777">//Convert to Stream</span>
        KStream&lt;<span style="color:#0a8;font-weight:bold">String</span>, AverageSpending&gt; averageSpendingStream =
                averageSpendingTable.toStream();

        <span style="color:#777">//print stream</span>
        averageSpendingStream
                .print(Printed.&lt;<span style="color:#0a8;font-weight:bold">String</span>, AverageSpending&gt;toSysOut().withLabel(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">averageSpending</span><span style="color:#710">&quot;</span></span>));

        <span style="color:#777">// Write the aggregation results back to a new topic</span>
        averageSpendingStream.to(TRANSACTION_AVERAGE_SPENDING_TOPIC,
                Produced.with(stringSerde, averageSpendingSerde));

        <span style="color:#777">// Build and print the topology</span>
        Topology topology = streamsBuilder.build();
        log.info(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Kafka Streams Topology:</span><span style="color:#b0b">\n</span><span style="color:#D20">{}</span><span style="color:#710">&quot;</span></span>, topology.describe());
    }

    <span style="color:#088;font-weight:bold">private</span> Serde&lt;Transactions&gt; createTransactionAvroSerde(<span style="color:#0a8;font-weight:bold">String</span> schemaRegistryUrl) {
        Serde&lt;Transactions&gt; serde = <span style="color:#080;font-weight:bold">new</span> SpecificAvroSerde&lt;&gt;();
        <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; config = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;&gt;();
        config.put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">schema.registry.url</span><span style="color:#710">&quot;</span></span>, schemaRegistryUrl);
        serde.configure(config, <span style="color:#069">false</span>); <span style="color:#777">// 'false' for value (true for key)</span>
        <span style="color:#080;font-weight:bold">return</span> serde;
    }

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">boolean</span> isCreditTransaction(Transactions transaction) {
        <span style="color:#080;font-weight:bold">return</span> transaction != <span style="color:#069">null</span>
                &amp;&amp; transaction.getTransactionAmount() != <span style="color:#069">null</span>
                &amp;&amp; transaction.getCustomerId() != <span style="color:#069">null</span>
                &amp;&amp;<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Credit</span><span style="color:#710">&quot;</span></span>.equalsIgnoreCase(transaction.getTransactionType());
    }

    <span style="color:#088;font-weight:bold">private</span> AverageSpending updateAverageSpending(<span style="color:#0a8;font-weight:bold">String</span> customerId, Transactions transaction, AverageSpending averageSpending) {
        averageSpending.setCustomerId(customerId);
        averageSpending.setTotalAmount(averageSpending.getTotalAmount() + <span style="color:#0a8;font-weight:bold">Double</span>.valueOf(transaction.getTransactionAmount()));
        averageSpending.setTransactionCount(averageSpending.getTransactionCount() + <span style="color:#00D">1</span>);
        <span style="color:#080;font-weight:bold">return</span> averageSpending;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we’ve defined a configuration method and annotated it with @Autowired. Spring processes this annotation and wires a matching bean from the container into the StreamsBuilder argument.</p>
</div>
<div class="paragraph">
<p>StreamsBuilder gives us access to all the Kafka Streams APIs, and it becomes like a regular Kafka Streams application. In our example, we’ve used this high-level DSL to define the transformations for our application:</p>
</div>
<div class="paragraph">
<p>Create a KStream from the input topic using the specified key and value SerDes.</p>
</div>
<div class="paragraph">
<p>Create a KTable by grouping by customer Id&#8217;s and the aggregating the data.</p>
</div>
<div class="paragraph">
<p>Materialize the result and convert the KTable to stream (KStream&lt;String, AverageSpending&gt; averageSpendingStream), and write the aggregated result back to our output kafka topic (average-spending)</p>
</div>
<div class="paragraph">
<p>In essence, Spring Boot provides a very thin wrapper around Streams API while managing the lifecycle of our KStream instance. It creates and configures the required components for the topology and executes our Streams application. Importantly, this lets us focus on our core business logic while Spring manages the lifecycle.</p>
</div>
<div class="paragraph">
<p>We have printed our topology, and it can be visualized by using <a href="https://zz85.github.io/kafka-streams-viz/">kafka-streams-viz</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/kstream/topology.png" alt="Topology Visualization">
</div>
<div class="title">Figure 4. Topology Visualization</div>
</div>
<div class="paragraph">
<p>The visualized topology provides a blueprint of how our Kafka Streams application processes data.
It is important for Optimization, Debuting and Documenting</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_create_redis_sink_connector">Step 2: Create Redis Sink Connector</h3>
<div class="paragraph">
<p>As we have demonstrated in our provisos article, We will create Redis sink connector to sink data from the kafka stream output topic to Redis to get real time average customer spending.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Redis Sink connector</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "name": "Average_Spending_RedisSinkConnector",
  "config": {
    "value.converter.schemas.enable": "false",
    "name": "Average_Spending_RedisSinkConnector",
    "connector.class": "com.redis.kafka.connect.RedisSinkConnector",
    "key.converter": "org.apache.kafka.connect.storage.StringConverter",
    "value.converter": "org.apache.kafka.connect.json.JsonConverter",
    "topics": "average-spending",
    "redis.cluster": "false",
    "redis.host": "redis",
    "redis.password": "*****",
    "redis.command": "JSONSET"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here, we’ve defined our redis sink connector that reads data from average-spending and push it to Redis, We used String converter for key and json converter for value, as our data is JSON with no attached schema we have disabled schema validation "value.converter.schemas.enable: false" and we used JSONSET command to save data as json in Redis.</p>
</div>
<div class="paragraph">
<p>Now lunch the sink connector, and we will insert some test data in the Transaction table and make sure that the stream application is running  :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span style="color:#B06;font-weight:bold">INSERT</span> <span style="color:#B06;font-weight:bold">INTO</span> public.T_Transactions (id, transaction_ref_number, customer_id, account_id, transaction_amount,
                                   transaction_type, created_at, updated_at)
<span style="color:#080;font-weight:bold">VALUES</span> (<span style="color:#088;font-weight:bold">DEFAULT</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ref-03</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="color:#00D">2</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="color:#00D">2</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="color:#00D">10</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Credit</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="color:#088;font-weight:bold">DEFAULT</span>,<span style="color:#088;font-weight:bold">Default</span>);

<span style="color:#B06;font-weight:bold">INSERT</span> <span style="color:#B06;font-weight:bold">INTO</span> public.T_Transactions (id, transaction_ref_number, customer_id, account_id, transaction_amount,
                                   transaction_type, created_at, updated_at)
<span style="color:#080;font-weight:bold">VALUES</span> (<span style="color:#088;font-weight:bold">DEFAULT</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ref-033</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="color:#00D">2</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="color:#00D">2</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="color:#00D">10</span>::<span style="color:#0a8;font-weight:bold">integer</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Credit</span><span style="color:#710">'</span></span>::<span style="color:#0a8;font-weight:bold">varchar</span>, <span style="color:#088;font-weight:bold">DEFAULT</span>,<span style="color:#088;font-weight:bold">Default</span>);</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/kstream/redis-sink-data.png" alt="Redis Average Spending">
</div>
<div class="title">Figure 5. Redis Average Spending</div>
</div>
<div class="paragraph">
<p>Here, we’ve insert new records to Transaction table for customer Id = 2
in redis you will found json document with key &lt;topic_name&gt;:&lt;customer_id&gt;
and we will found that customer ID = 2  has 2 transactions with average spending = 10 ,  total transactions count = 2 and total transaction amount = 20</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_update_microservice_to_read_data_from_redis">Step 3: Update Microservice to Read data from Redis</h3>
<div class="paragraph">
<p>Now we have the data presented in our Redis , lets start updating our microservice to include a new api to get the average spending by customer Id .</p>
</div>
<div class="paragraph">
<p>We will create out Document Class that represent the Json Document in redis as following :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Data</span>
<span style="color:#007">@RequiredArgsConstructor</span>(staticName = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">of</span><span style="color:#710">&quot;</span></span>)
<span style="color:#007">@AllArgsConstructor</span>(access = AccessLevel.PROTECTED)
<span style="color:#007">@Document</span>(value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">average-spending</span><span style="color:#710">&quot;</span></span>,indexName = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">average-spendingIdx</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">AverageSpending</span> {

    <span style="color:#007">@Id</span>
    <span style="color:#007">@Indexed</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> customerId;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">double</span> averageSpending;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">double</span> totalAmount;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">long</span> transactionCount;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create Repository class :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Repository</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">interface</span> <span style="color:#B06;font-weight:bold">AverageSpendingRepository</span> <span style="color:#088;font-weight:bold">extends</span> RedisDocumentRepository&lt;AverageSpending,<span style="color:#0a8;font-weight:bold">String</span>&gt; {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Update Customer Service by adding new method to get customer spending by customer Id:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span style="color:#088;font-weight:bold">public</span> Optional&lt;AverageSpending&gt; getCustomerAverageSpending(<span style="color:#0a8;font-weight:bold">String</span> customerId){
        <span style="color:#080;font-weight:bold">return</span> averageSpendingRepository.findById(customerId);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally update our customer controller Class with new API  :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span style="color:#007">@GetMapping</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/{customerId}/avrage-spending</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">public</span> ResponseEntity&lt;AverageSpending&gt; getCustomerAverageSpending(<span style="color:#007">@PathVariable</span> <span style="color:#0a8;font-weight:bold">String</span> customerId) {
        Optional&lt;AverageSpending&gt; averageSpending = customerService.getCustomerAverageSpending(customerId);
        <span style="color:#080;font-weight:bold">if</span>(averageSpending.isPresent()) {
            <span style="color:#080;font-weight:bold">return</span> ResponseEntity.ok(averageSpending.get());
        }
        <span style="color:#080;font-weight:bold">return</span> ResponseEntity.notFound().build();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lets Test Our new service with customer Id = 2</p>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/kstream/TestContoller.png" alt="Customer Average Spending">
</div>
<div class="title">Figure 6. Customer Average Spending</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary">Summary</h2>
<div class="sectionbody">

</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.0<br>
Last updated 2024-11-18 03:46:47 +0300
</div>
</div>
<script>
;(function () { /*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
  'use strict'

  var config = (document.currentScript || {}).dataset || {}
  var forEach = Array.prototype.forEach

  init(document.querySelectorAll('.tabs'))

  function init (tabsBlocks) {
    if (!tabsBlocks.length) return
    forEach.call(tabsBlocks, function (tabs) {
      var syncIds = tabs.classList.contains('is-sync') ? {} : undefined
      var tablist = tabs.querySelector('.tablist ul')
      tablist.setAttribute('role', 'tablist')
      var start
      forEach.call(tablist.querySelectorAll('li'), function (tab, idx) {
        tab.tabIndex = -1
        tab.setAttribute('role', tab.classList.add('tab') || 'tab')
        var id, anchor, syncId
        if (!(id = tab.id) && (anchor = tab.querySelector('a[id]'))) {
          id = tab.id = anchor.parentNode.removeChild(anchor).id
        }
        var panel = id && tabs.querySelector('.tabpanel[aria-labelledby~="' + id + '"]')
        if (!panel) return idx ? undefined : toggleSelected(tab, true) // invalid state
        syncIds && (((syncId = tab.textContent.trim()) in syncIds) ? (syncId = undefined) : true) &&
        (syncIds[(tab.dataset.syncId = syncId)] = tab)
        idx || (syncIds && (start = { tab: tab, panel: panel })) ? toggleHidden(panel, true) : toggleSelected(tab, true)
        tab.setAttribute('aria-controls', panel.id)
        panel.setAttribute('role', 'tabpanel')
        var onClick = syncId === undefined ? activateTab : activateTabSync
        tab.addEventListener('click', onClick.bind({ tabs: tabs, tab: tab, panel: panel }))
      })
      if (!tabs.closest('.tabpanel')) {
        forEach.call(tabs.querySelectorAll('.tabpanel table.tableblock'), function (table) {
          var container = Object.assign(document.createElement('div'), { className: 'tablecontainer' })
          table.parentNode.insertBefore(container, table).appendChild(table)
        })
      }
      if (start) {
        var syncGroupId
        for (var i = 0, lst = tabs.classList, len = lst.length, className; i !== len; i++) {
          if (!(className = lst.item(i)).startsWith('data-sync-group-id=')) continue
          tabs.dataset.syncGroupId = syncGroupId = lst.remove(className) || className.slice(19).replace(/\u00a0/g, ' ')
          break
        }
        if (syncGroupId === undefined) tabs.dataset.syncGroupId = syncGroupId = Object.keys(syncIds).sort().join('|')
        var preferredSyncId = 'syncStorageKey' in config &&
          window[(config.syncStorageScope || 'local') + 'Storage'].getItem(config.syncStorageKey + '-' + syncGroupId)
        var tab = preferredSyncId && syncIds[preferredSyncId]
        tab && Object.assign(start, { tab: tab, panel: document.getElementById(tab.getAttribute('aria-controls')) })
        toggleSelected(start.tab, true) || toggleHidden(start.panel, false)
      }
    })
    onHashChange()
    toggleClassOnEach(tabsBlocks, 'is-loading', 'remove')
    window.setTimeout(toggleClassOnEach.bind(null, tabsBlocks, 'is-loaded', 'add'), 0)
    window.addEventListener('hashchange', onHashChange)
  }

  function activateTab (e) {
    var tab = this.tab
    var tabs = this.tabs || (this.tabs = tab.closest('.tabs'))
    var panel = this.panel || (this.panel = document.getElementById(tab.getAttribute('aria-controls')))
    querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (el) {
      toggleSelected(el, el === tab)
    })
    querySelectorWithSiblings(tabs, '.tabpanel', 'tabpanel').forEach(function (el) {
      toggleHidden(el, el !== panel)
    })
    if (!this.isSync && 'syncStorageKey' in config && 'syncGroupId' in tabs.dataset) {
      var storageKey = config.syncStorageKey + '-' + tabs.dataset.syncGroupId
      window[(config.syncStorageScope || 'local') + 'Storage'].setItem(storageKey, tab.dataset.syncId)
    }
    if (!e) return
    var loc = window.location
    var hashIdx = loc.hash ? loc.href.indexOf('#') : -1
    if (~hashIdx) window.history.replaceState(null, '', loc.href.slice(0, hashIdx))
    e.preventDefault()
  }

  function activateTabSync (e) {
    activateTab.call(this, e)
    var thisTabs = this.tabs
    var thisTab = this.tab
    var initialY = thisTabs.getBoundingClientRect().y
    forEach.call(document.querySelectorAll('.tabs'), function (tabs) {
      if (tabs === thisTabs || tabs.dataset.syncGroupId !== thisTabs.dataset.syncGroupId) return
      querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (tab) {
        if (tab.dataset.syncId === thisTab.dataset.syncId) activateTab.call({ tabs: tabs, tab: tab, isSync: true })
      })
    })
    var shiftedBy = thisTabs.getBoundingClientRect().y - initialY
    if (shiftedBy && (shiftedBy = Math.round(shiftedBy))) window.scrollBy({ top: shiftedBy, behavior: 'instant' })
  }

  function querySelectorWithSiblings (scope, selector, siblingClass) {
    var el = scope.querySelector(selector)
    if (!el) return []
    var result = [el]
    while ((el = el.nextElementSibling) && el.classList.contains(siblingClass)) result.push(el)
    return result
  }

  function toggleClassOnEach (elements, className, method) {
    forEach.call(elements, function (el) {
      el.classList[method](className)
    })
  }

  function toggleHidden (el, state) {
    el.classList[(el.hidden = state) ? 'add' : 'remove']('is-hidden')
  }

  function toggleSelected (el, state) {
    el.setAttribute('aria-selected', '' + state)
    el.classList[state ? 'add' : 'remove']('is-selected')
    el.tabIndex = state ? 0 : -1
  }

  function onHashChange () {
    var id = window.location.hash.slice(1)
    if (!id) return
    var tab = document.getElementById(~id.indexOf('%') ? decodeURIComponent(id) : id)
    if (!(tab && tab.classList.contains('tab'))) return
    'syncId' in tab.dataset ? activateTabSync.call({ tab: tab }) : activateTab.call({ tab: tab })
  }
})()
</script>
</body>
</html>